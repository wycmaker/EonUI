import{j as u}from"./jsx-runtime-D_zvdyIk.js";import{r as n,R as le}from"./iframe-DtrAF50Y.js";import{r as ie}from"./blocks-CAYfFhLU.js";import{u as oe}from"./useClickOutside-DMt3zXhd.js";import{u as de}from"./usePortal-hRK3-VjC.js";import{c as j}from"./cn-Dtjc6EhN.js";import{s as ce,r as fe}from"./clearable-C08SD5GV.js";import{h as me,i as pe}from"./icons-B4aNx7RA.js";const he=m=>{const{onArrowUp:h,onArrowDown:i,onEnter:b,onEscape:o,onTab:c,enabled:d=!0}=m,a=n.useCallback(t=>{if(d)switch(t.key){case"ArrowUp":t.preventDefault(),h?.();break;case"ArrowDown":t.preventDefault(),i?.();break;case"Enter":t.preventDefault(),b?.();break;case"Escape":o?.();break;case"Tab":c?.();break}},[d,h,i,b,o,c]);n.useEffect(()=>{if(d)return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[a,d])},be=(m,h,i)=>{const[b,o]=n.useState(h),c=m!==void 0,d=c?m:b,a=n.useCallback(t=>{c||o(t),i?.(t)},[c,i]);return[d,a]},k=le.forwardRef(({className:m,variant:h="default",size:i="md",status:b="default",options:o=[],value:c,defaultValue:d,multiple:a=!1,filterable:t=!1,clearable:T=!1,disabled:E=!1,placeholder:L="請選擇",searchPlaceholder:U="搜尋選項",noDataText:W="無資料",multipleDisplayMode:N="count",maxTagCount:q=3,width:H,autoComplete:K="off",onChange:Q,onClear:S,onSearch:I,...$},z)=>{const[s,_]=n.useState(!1),[R,v]=n.useState(""),[F,x]=n.useState(-1),B=n.useRef(null),V=n.useRef(null),M=n.useRef(null),[r,G]=be(c,d!==void 0?d:a?[]:void 0,Q),{position:D,calculatePosition:J}=de({triggerRef:B,isOpen:s,offset:4}),g=t?o.filter(e=>e.label.toLowerCase().includes(R.toLowerCase())):o,X=n.useCallback(()=>{if(a&&Array.isArray(r)){if(r.length===0)return null;if(N==="items"){const e=r.map(p=>o.find(C=>C.value===p)).filter(p=>!!p),l=()=>{const C=Math.min(q,i==="sm"?1:i==="md"?2:3);return e.length<=C?{visibleItems:e,hasMore:!1,moreCount:0}:{visibleItems:e.slice(0,C),hasMore:!0,moreCount:e.length-C}},{visibleItems:f,hasMore:y,moreCount:se}=l();return u.jsxs("div",{className:"flex items-center gap-1 flex-1 min-w-0 overflow-hidden",children:[f.map(p=>u.jsx("span",{className:"inline-flex items-center px-2 py-0.5 text-xs bg-primary-50 text-primary-600 rounded-md border border-primary-200 flex-shrink-0",style:{maxWidth:`${Math.max(60,200/Math.max(f.length+(y?1:0),1))}px`},children:u.jsx("span",{className:"truncate",children:p.label})},p.value)),y&&u.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 text-xs bg-gray-100 text-gray-600 rounded-md flex-shrink-0",children:["+",se]})]})}else return`已選 ${r.length} 項`}else if(!a&&r!==void 0&&r!==null)return o.find(l=>l.value===r)?.label||"";return null},[r,a,o,N,q,i]),w=G,O=n.useCallback(e=>{if(!e.disabled)if(a){const l=Array.isArray(r)?r:[],f=l.includes(e.value)?l.filter(y=>y!==e.value):[...l,e.value];w(f)}else w(e.value),_(!1),v("")},[a,r,w]),Y=n.useCallback(e=>{e?.stopPropagation(),w(a?[]:void 0),S?.(),v("")},[a,w,S]),Z=n.useCallback(e=>{v(e),x(-1),I?.(e)},[I]);oe([B,M],()=>{_(!1),v(""),x(-1)},s),he({enabled:s,onArrowDown:()=>{x(e=>e<g.length-1?e+1:e)},onArrowUp:()=>{x(e=>e>0?e-1:e)},onEnter:()=>{if(F>=0&&F<g.length){const e=g[F];e&&O(e)}},onEscape:()=>{_(!1),v(""),x(-1)}}),n.useEffect(()=>{s&&t&&V.current&&V.current.focus()},[s,t]);const ee="relative w-full rounded-md transition-all duration-200 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 cursor-pointer",ue={default:"bg-white border border-gray-300 focus-within:border-2 focus-within:border-primary focus-within:shadow-[0_0_0_3px_rgb(37_99_235_/_0.1)]",filled:"bg-gray-50 border border-transparent focus-within:bg-white focus-within:border-2 focus-within:border-primary focus-within:shadow-[0_0_0_3px_rgb(37_99_235_/_0.1)]",outline:"bg-transparent border-2 border-gray-300 focus-within:border-primary focus-within:shadow-[0_0_0_3px_rgb(37_99_235_/_0.1)]"},ae={sm:"h-8 px-3 py-1 text-sm",md:"h-10 px-3 py-2 text-sm",lg:"h-12 px-4 py-3 text-base"},re={default:"",error:"border-error focus-within:border-2 focus-within:border-error focus-within:shadow-[0_0_0_3px_rgb(239_68_68_/_0.1)]",success:"border-success focus-within:border-2 focus-within:border-success focus-within:shadow-[0_0_0_3px_rgb(16_185_129_/_0.1)]",warning:"border-warning focus-within:border-2 focus-within:border-warning focus-within:shadow-[0_0_0_3px_rgb(251_191_36_/_0.1)]"},P=ce(T||!1,r,E||!1),A=X(),ne=j(ee,ue[h],ae[i],re[b],E&&"cursor-not-allowed opacity-50",m),te=n.useCallback(e=>a&&Array.isArray(r)?r.includes(e.value):r===e.value,[r,a]);return u.jsxs("div",{ref:B,className:"relative w-full",style:{width:H},...$,children:[u.jsx("div",{ref:z,className:ne,onClick:()=>{E||(s||J(),_(!s))},"aria-expanded":s,"aria-haspopup":"listbox",role:"combobox",children:u.jsxs("div",{className:"flex items-center justify-between w-full min-w-0",children:[u.jsx("div",{className:"flex-1 min-w-0 flex items-center",children:t&&s?u.jsx("input",{ref:V,type:"text",value:R,onChange:e=>Z(e.target.value),placeholder:U,className:"w-full bg-transparent outline-none",onClick:e=>e.stopPropagation(),autoComplete:K}):A?typeof A=="string"?u.jsx("span",{className:"truncate",children:A}):A:u.jsx("span",{className:"text-gray-400 truncate",children:L})}),u.jsx("div",{className:"flex items-center ml-2",children:P?fe(P,Y,"清除選擇"):u.jsx(me,{className:j("h-4 w-4 text-gray-400 transition-transform duration-200",s&&"rotate-180")})})]})}),s&&ie.createPortal(u.jsx("div",{ref:M,className:"absolute bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",style:{top:D.top,left:D.left,width:"max-content",minWidth:D.width,maxWidth:"min(400px, 100vw - 32px)",zIndex:9999},role:"listbox","aria-multiselectable":a,children:g.length===0?u.jsx("div",{className:"px-3 py-2 text-sm text-gray-500 text-center",children:W}):g.map((e,l)=>{const f=te(e),y=l===F;return u.jsx("div",{className:j("px-3 py-2 text-sm cursor-pointer transition-colors","hover:bg-gray-100 focus:bg-gray-100",y&&"bg-gray-100",f&&"bg-primary-50 text-primary-600 font-medium border-primary-600",e.disabled&&"cursor-not-allowed opacity-50 hover:bg-transparent"),onClick:()=>O(e),role:"option","aria-selected":f,onMouseEnter:()=>x(l),children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("span",{className:"flex-1 truncate",children:e.label}),a&&f&&u.jsx(pe,{className:"h-4 w-4 ml-2 flex-shrink-0"})]})},e.value)})}),document.body)]})});k.displayName="Select";try{k.displayName="Select",k.__docgenInfo={description:"",displayName:"Select",props:{variant:{defaultValue:{value:"default"},description:"下拉選單的視覺樣式變體",name:"variant",required:!1,type:{name:"enum",value:[{value:"undefined"},{value:'"outline"'},{value:'"default"'},{value:'"filled"'}]}},size:{defaultValue:{value:"md"},description:"下拉選單的大小",name:"size",required:!1,type:{name:"enum",value:[{value:"undefined"},{value:'"sm"'},{value:'"md"'},{value:'"lg"'}]}},status:{defaultValue:{value:"default"},description:"下拉選單的狀態",name:"status",required:!1,type:{name:"enum",value:[{value:"undefined"},{value:'"success"'},{value:'"warning"'},{value:'"error"'},{value:'"default"'}]}},options:{defaultValue:{value:"[]"},description:"選項列表",name:"options",required:!1,type:{name:"SelectOption[]"}},value:{defaultValue:null,description:"當前選中的值（單選模式為單個值，多選模式為陣列）",name:"value",required:!1,type:{name:"string | number | (string | number)[] | undefined"}},defaultValue:{defaultValue:null,description:"預設值",name:"defaultValue",required:!1,type:{name:"string | number | (string | number)[] | undefined"}},multiple:{defaultValue:{value:"false"},description:"是否為多選模式",name:"multiple",required:!1,type:{name:"boolean | undefined"}},filterable:{defaultValue:{value:"false"},description:"是否可以搜尋",name:"filterable",required:!1,type:{name:"boolean | undefined"}},clearable:{defaultValue:{value:"false"},description:"是否顯示清除按鈕",name:"clearable",required:!1,type:{name:"boolean | undefined"}},disabled:{defaultValue:{value:"false"},description:"是否禁用",name:"disabled",required:!1,type:{name:"boolean | undefined"}},placeholder:{defaultValue:{value:"請選擇"},description:"佔位符文字",name:"placeholder",required:!1,type:{name:"string | undefined"}},searchPlaceholder:{defaultValue:{value:"搜尋選項"},description:"搜尋時的佔位符文字",name:"searchPlaceholder",required:!1,type:{name:"string | undefined"}},noDataText:{defaultValue:{value:"無資料"},description:"無選項時顯示的文字",name:"noDataText",required:!1,type:{name:"string | undefined"}},multipleDisplayMode:{defaultValue:{value:"count"},description:"多選模式下的顯示方式（顯示選中項目或數量）",name:"multipleDisplayMode",required:!1,type:{name:"enum",value:[{value:"undefined"},{value:'"items"'},{value:'"count"'}]}},maxTagCount:{defaultValue:{value:"3"},description:"多選模式下最多顯示的標籤數量",name:"maxTagCount",required:!1,type:{name:"number | undefined"}},width:{defaultValue:null,description:"寬度",name:"width",required:!1,type:{name:"string | undefined"}},autoComplete:{defaultValue:{value:"off"},description:"自動完成屬性（用於搜尋輸入框）",name:"autoComplete",required:!1,type:{name:"string | undefined"}},onChange:{defaultValue:null,description:"值改變時的回調",name:"onChange",required:!1,type:{name:"((value: string | number | (string | number)[] | undefined) => void) | undefined"}},onClear:{defaultValue:null,description:"清除按鈕的回調函數",name:"onClear",required:!1,type:{name:"(() => void) | undefined"}},onSearch:{defaultValue:null,description:"搜尋時的回調",name:"onSearch",required:!1,type:{name:"((query: string) => void) | undefined"}}}}}catch{}export{k as S,be as u};
