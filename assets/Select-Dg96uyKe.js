import{j as u}from"./jsx-runtime-D_zvdyIk.js";import{r as n,R as te}from"./iframe-DMlPHyXL.js";import{c as V}from"./cn-Dtjc6EhN.js";import{s as se,r as le}from"./clearable-Cbs5Twkk.js";import{C as ie,b as oe}from"./icons-CWF-JOA3.js";const de=(i,c,t=!0)=>{const d=n.useCallback(s=>{i.current&&!i.current.contains(s.target)&&c()},[i,c]);n.useEffect(()=>{if(t)return document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[d,t])},ce=i=>{const{onArrowUp:c,onArrowDown:t,onEnter:d,onEscape:s,onTab:p,enabled:f=!0}=i,a=n.useCallback(l=>{if(f)switch(l.key){case"ArrowUp":l.preventDefault(),c?.();break;case"ArrowDown":l.preventDefault(),t?.();break;case"Enter":l.preventDefault(),d?.();break;case"Escape":s?.();break;case"Tab":p?.();break}},[f,c,t,d,s,p]);n.useEffect(()=>{if(f)return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[a,f])},fe=(i,c,t)=>{const[d,s]=n.useState(c),p=i!==void 0,f=p?i:d,a=n.useCallback(l=>{p||s(l),t?.(l)},[p,t]);return[f,a]},D=te.forwardRef(({className:i,variant:c="default",size:t="md",status:d="default",options:s=[],value:p,defaultValue:f,multiple:a=!1,filterable:l=!1,clearable:O=!1,disabled:E=!1,placeholder:L="請選擇",searchPlaceholder:T="搜尋選項",noDataText:P="無資料",multipleDisplayMode:k="count",maxTagCount:j=3,width:U="200px",autoComplete:W="off",onChange:H,onClear:N,onSearch:q,...K},Q)=>{const[m,_]=n.useState(!1),[S,v]=n.useState(""),[F,x]=n.useState(-1),I=n.useRef(null),B=n.useRef(null),$=n.useRef(null),[r,z]=fe(p,f!==void 0?f:a?[]:void 0,H),g=l?s.filter(e=>e.label.toLowerCase().includes(S.toLowerCase())):s,G=n.useCallback(()=>{if(a&&Array.isArray(r)){if(r.length===0)return null;if(k==="items"){const e=r.map(b=>s.find(C=>C.value===b)).filter(b=>!!b),o=()=>{const C=Math.min(j,t==="sm"?1:t==="md"?2:3);return e.length<=C?{visibleItems:e,hasMore:!1,moreCount:0}:{visibleItems:e.slice(0,C),hasMore:!0,moreCount:e.length-C}},{visibleItems:h,hasMore:y,moreCount:re}=o();return u.jsxs("div",{className:"flex items-center gap-1 flex-1 min-w-0 overflow-hidden",children:[h.map(b=>u.jsx("span",{className:"inline-flex items-center px-2 py-0.5 text-xs bg-primary-50 text-primary-600 rounded-md border border-primary-200 flex-shrink-0",style:{maxWidth:`${Math.max(60,200/Math.max(h.length+(y?1:0),1))}px`},children:u.jsx("span",{className:"truncate",children:b.label})},b.value)),y&&u.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 text-xs bg-gray-100 text-gray-600 rounded-md flex-shrink-0",children:["+",re]})]})}else return`已選 ${r.length} 項`}else if(!a&&r!==void 0&&r!==null)return s.find(o=>o.value===r)?.label||"";return null},[r,a,s,k,j,t]),w=z,R=n.useCallback(e=>{if(!e.disabled)if(a){const o=Array.isArray(r)?r:[],h=o.includes(e.value)?o.filter(y=>y!==e.value):[...o,e.value];w(h)}else w(e.value),_(!1),v("")},[a,r,w]),J=n.useCallback(e=>{e?.stopPropagation(),w(a?[]:void 0),N?.(),v("")},[a,w,N]),X=n.useCallback(e=>{v(e),x(-1),q?.(e)},[q]);de(I,()=>{_(!1),v(""),x(-1)},m),ce({enabled:m,onArrowDown:()=>{x(e=>e<g.length-1?e+1:e)},onArrowUp:()=>{x(e=>e>0?e-1:e)},onEnter:()=>{if(F>=0&&F<g.length){const e=g[F];e&&R(e)}},onEscape:()=>{_(!1),v(""),x(-1)}}),n.useEffect(()=>{m&&l&&B.current&&B.current.focus()},[m,l]);const Y="relative w-full rounded-md transition-all duration-200 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 cursor-pointer",Z={default:"bg-white border border-gray-300 focus-within:border-2 focus-within:border-primary focus-within:shadow-[0_0_0_3px_rgb(37_99_235_/_0.1)]",filled:"bg-gray-50 border border-transparent focus-within:bg-white focus-within:border-2 focus-within:border-primary focus-within:shadow-[0_0_0_3px_rgb(37_99_235_/_0.1)]",outline:"bg-transparent border-2 border-gray-300 focus-within:border-primary focus-within:shadow-[0_0_0_3px_rgb(37_99_235_/_0.1)]"},ee={sm:"h-8 px-3 py-1 text-sm",md:"h-10 px-3 py-2 text-sm",lg:"h-12 px-4 py-3 text-base"},ue={default:"",error:"border-error focus-within:border-2 focus-within:border-error focus-within:shadow-[0_0_0_3px_rgb(239_68_68_/_0.1)]",success:"border-success focus-within:border-2 focus-within:border-success focus-within:shadow-[0_0_0_3px_rgb(16_185_129_/_0.1)]",warning:"border-warning focus-within:border-2 focus-within:border-warning focus-within:shadow-[0_0_0_3px_rgb(251_191_36_/_0.1)]"},M=se(O||!1,r,E||!1),A=G(),ae=V(Y,Z[c],ee[t],ue[d],E&&"cursor-not-allowed opacity-50",i),ne=n.useCallback(e=>a&&Array.isArray(r)?r.includes(e.value):r===e.value,[r,a]);return u.jsxs("div",{ref:I,className:"relative w-full",style:{width:U},...K,children:[u.jsx("div",{ref:Q,className:ae,onClick:()=>!E&&_(!m),"aria-expanded":m,"aria-haspopup":"listbox",role:"combobox",children:u.jsxs("div",{className:"flex items-center justify-between w-full min-w-0",children:[u.jsx("div",{className:"flex-1 min-w-0 flex items-center",children:l&&m?u.jsx("input",{ref:B,type:"text",value:S,onChange:e=>X(e.target.value),placeholder:T,className:"w-full bg-transparent outline-none",onClick:e=>e.stopPropagation(),autoComplete:W}):A?typeof A=="string"?u.jsx("span",{className:"truncate",children:A}):A:u.jsx("span",{className:"text-gray-400 truncate",children:L})}),u.jsx("div",{className:"flex items-center ml-2",children:M?le(M,J,"清除選擇"):u.jsx(ie,{className:V("h-4 w-4 text-gray-400 transition-transform duration-200",m&&"rotate-180")})})]})}),m&&u.jsx("div",{ref:$,className:"absolute top-full left-0 z-50 mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",style:{minWidth:"100%",width:"max-content",maxWidth:"min(400px, 100vw - 32px)"},role:"listbox","aria-multiselectable":a,children:g.length===0?u.jsx("div",{className:"px-3 py-2 text-sm text-gray-500 text-center",children:P}):g.map((e,o)=>{const h=ne(e),y=o===F;return u.jsx("div",{className:V("px-3 py-2 text-sm cursor-pointer transition-colors","hover:bg-gray-100 focus:bg-gray-100",y&&"bg-gray-100",h&&"bg-primary-50 text-primary-600 font-medium border-primary-600",e.disabled&&"cursor-not-allowed opacity-50 hover:bg-transparent"),onClick:()=>R(e),role:"option","aria-selected":h,onMouseEnter:()=>x(o),children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("span",{className:"flex-1 truncate",children:e.label}),a&&h&&u.jsx(oe,{className:"h-4 w-4 ml-2 flex-shrink-0"})]})},e.value)})})]})});D.displayName="Select";try{D.displayName="Select",D.__docgenInfo={description:"",displayName:"Select",props:{variant:{defaultValue:{value:"default"},description:"下拉選單的視覺樣式變體",name:"variant",required:!1,type:{name:"enum",value:[{value:"undefined"},{value:'"default"'},{value:'"filled"'},{value:'"outline"'}]}},size:{defaultValue:{value:"md"},description:"下拉選單的大小",name:"size",required:!1,type:{name:"enum",value:[{value:"undefined"},{value:'"sm"'},{value:'"md"'},{value:'"lg"'}]}},status:{defaultValue:{value:"default"},description:"下拉選單的狀態",name:"status",required:!1,type:{name:"enum",value:[{value:"undefined"},{value:'"default"'},{value:'"error"'},{value:'"success"'},{value:'"warning"'}]}},options:{defaultValue:{value:"[]"},description:"選項列表",name:"options",required:!1,type:{name:"SelectOption[]"}},value:{defaultValue:null,description:"當前選中的值（單選模式為單個值，多選模式為陣列）",name:"value",required:!1,type:{name:"string | number | (string | number)[] | undefined"}},defaultValue:{defaultValue:null,description:"預設值",name:"defaultValue",required:!1,type:{name:"string | number | (string | number)[] | undefined"}},multiple:{defaultValue:{value:"false"},description:"是否為多選模式",name:"multiple",required:!1,type:{name:"boolean | undefined"}},filterable:{defaultValue:{value:"false"},description:"是否可以搜尋",name:"filterable",required:!1,type:{name:"boolean | undefined"}},clearable:{defaultValue:{value:"false"},description:"是否顯示清除按鈕",name:"clearable",required:!1,type:{name:"boolean | undefined"}},disabled:{defaultValue:{value:"false"},description:"是否禁用",name:"disabled",required:!1,type:{name:"boolean | undefined"}},placeholder:{defaultValue:{value:"請選擇"},description:"佔位符文字",name:"placeholder",required:!1,type:{name:"string | undefined"}},searchPlaceholder:{defaultValue:{value:"搜尋選項"},description:"搜尋時的佔位符文字",name:"searchPlaceholder",required:!1,type:{name:"string | undefined"}},noDataText:{defaultValue:{value:"無資料"},description:"無選項時顯示的文字",name:"noDataText",required:!1,type:{name:"string | undefined"}},multipleDisplayMode:{defaultValue:{value:"count"},description:"多選模式下的顯示方式（顯示選中項目或數量）",name:"multipleDisplayMode",required:!1,type:{name:"enum",value:[{value:"undefined"},{value:'"items"'},{value:'"count"'}]}},maxTagCount:{defaultValue:{value:"3"},description:"多選模式下最多顯示的標籤數量",name:"maxTagCount",required:!1,type:{name:"number | undefined"}},width:{defaultValue:{value:"200px"},description:"寬度",name:"width",required:!1,type:{name:"string | undefined"}},autoComplete:{defaultValue:{value:"off"},description:"自動完成屬性（用於搜尋輸入框）",name:"autoComplete",required:!1,type:{name:"string | undefined"}},onChange:{defaultValue:null,description:"值改變時的回調",name:"onChange",required:!1,type:{name:"((value: string | number | (string | number)[] | undefined) => void) | undefined"}},onClear:{defaultValue:null,description:"清除按鈕的回調函數",name:"onClear",required:!1,type:{name:"(() => void) | undefined"}},onSearch:{defaultValue:null,description:"搜尋時的回調",name:"onSearch",required:!1,type:{name:"((query: string) => void) | undefined"}}}}}catch{}export{D as S};
